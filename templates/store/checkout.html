{% extends "base/base.html" %}
{% load static %}

{% block title %}Ödeme{% endblock %}

{% block slider %}
{% endblock slider %}

{% block extra_head%}
<link rel="stylesheet" type="text/css" href="{% static 'css/style.min.css' %}">
{% endblock extra_head%}

{% block content %}

<main class="main checkout">
    <div class="page-content pt-7 pb-10 mb-10">
        <div class="step-by pr-4 pl-4">
            <h3 class="title title-simple title-step"><a href="{% url 'cart' %}">1. Sepet</a></h3>
            <h3 class="title title-simple title-step active"><a href="{% url 'checkout' %}">2. Ödeme Bilgileri</a></h3>
            <h3 class="title title-simple title-step"><a href="{% url 'order' %}">3. Sipariş Tamamlandı</a></h3>
        </div>
        <div class="container mt-7">
            <div class="card accordion">
                <div class="alert alert-light alert-primary alert-icon mb-4 card-header">
                    <i class="fas fa-exclamation-circle"></i>
                    <span class="text-body">Have a coupon?</span>
                    <a href="#alert-body2" class="text-primary">Click here to enter your code</a>
                </div>
                <div class="alert-body collapsed" id="alert-body2">
                    <p>If you have a coupon code, please apply it below.</p>
                    <div class="check-coupon-box d-flex">
                        <input type="text" name="coupon_code"
                            class="input-text form-control text-grey ls-m mr-4 mb-4" id="coupon_code" value=""
                            placeholder="Coupon code">
                        <button type="submit" class="btn btn-dark btn-rounded btn-outline mb-4">Apply
                            Coupon</button>
                    </div>
                </div>
            </div>
            <form action="#" class="form">
                <div class="row">
                    <div class="col-lg-6 mb-6 mb-lg-0 pr-lg-4">
                        <h3 class="title title-simple text-left text-uppercase">Billing Details</h3>
                        <div class="row">
                            <div class="col-xs-6">
                                <label>First Name *</label>
                                <input type="text" class="form-control" name="first-name" required="" />
                            </div>
                            <div class="col-xs-6">
                                <label>Last Name *</label>
                                <input type="text" class="form-control" name="last-name" required="" />
                            </div>
                        </div>
                        <label>Company Name (Optional)</label>
                        <input type="text" class="form-control" name="company-name" required="" />
                        <label>Country / Region *</label>
                        <div class="select-box">
                            <select name="country" class="form-control">
                                <option value="us" selected>United States (US)</option>
                                <option value="uk"> United Kingdom</option>
                                <option value="fr">France</option>
                                <option value="aus">Austria</option>
                            </select>
                        </div>
                        <label>Street Address *</label>
                        <input type="text" class="form-control" name="address1" required=""
                            placeholder="House number and street name" />
                        <input type="text" class="form-control" name="address2" required=""
                            placeholder="Apartment, suite, unit, etc. (optional)" />
                        <div class="row">
                            <div class="col-xs-6">
                                <label>Town / City *</label>
                                <input type="text" class="form-control" name="city" required="" />
                            </div>
                            <div class="col-xs-6">
                                <label>State *</label>
                                <input type="text" class="form-control" name="state" required="" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <label>ZIP *</label>
                                <input type="text" class="form-control" name="zip" required="" />
                            </div>
                            <div class="col-xs-6">
                                <label>Phone *</label>
                                <input type="text" class="form-control" name="phone" required="" />
                            </div>
                        </div>
                        <label>Email Address *</label>
                        <input type="text" class="form-control" name="email-address" required="" />
                        <div class="form-checkbox mb-0">
                            <input type="checkbox" class="custom-checkbox" id="create-account"
                                name="create-account">
                            <label class="form-control-label ls-s" for="create-account">Create an
                                account?</label>
                        </div>
                        <div class="form-checkbox mb-6">
                            <input type="checkbox" class="custom-checkbox" id="different-address"
                                name="different-address">
                            <label class="form-control-label ls-s" for="different-address">Ship to a different
                                address?</label>
                        </div>
                        <h2 class="title title-simple text-uppercase text-left">Additional Information</h2>
                        <label>Order Notes (Optional)</label>
                        <textarea class="form-control pb-2 pt-2 mb-0" cols="30" rows="5"
                            placeholder="Notes about your order, e.g. special notes for delivery"></textarea>
                    </div>
                    <aside class="col-lg-6 sticky-sidebar-wrapper">
                        <div class="sticky-sidebar mt-1" data-sticky-options="{'bottom': 50}">
                            <div class="summary pt-5">
                                <h3 class="title title-simple text-left text-uppercase">Sipariş Özeti</h3>
                                <table class="order-table">
                                    <thead>
                                        <tr>
                                            <th>Ürünler</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for prod in cartitems %}
                                        <tr>
                                            <td class="product-name">
                                                <div class="product-name-section">
                                                    {% if prod.product.product_type == 'Tekil' %} 
                                                        <a href="{% url 'product' prod.product.ProductID %}" class="product-name">{{ prod.product.product_web_name }} | {{ prod.size_stock.size }}</a>
                                                    {% elif prod.product.product_type == 'Kombin' %} 
                                                        <a href="{% url 'combproduct' prod.product.ProductID %}" class="product-name">{{ prod.product.product_web_name }}</a>
                                                    {% endif %}
                                                </div>
                                                <span class="product-quantity">
                                                    ×&nbsp;{{ prod.quantity }}
                                                </span>
                                            </td>
                                            <td class="product-total text-body">{{ prod.total_price }} ₺</td>
                                        </tr>
                                        {% endfor %}
                                        <tr class="summary-subtotal">
                                            <td>
                                                <h4 class="summary-subtitle">Ürün Toplamı</h4>
                                            </td>
                                            <td class="summary-subtotal-price pb-0 pt-0">{{ cart.total_price }} ₺
                                            </td>
                                        </tr>
                                        <tr class="sumnary-shipping shipping-row-last">
                                            <td>
                                                <h4 class="summary-subtitle">Kargo Ücreti</h4>
                                            </td>
                                            <td class="summary-subtotal-price pb-0 pt-0">210.00 ₺
                                            </td>
                                        </tr>
                                        <tr class="summary-total">
                                            <td class="pb-0">
                                                <h4 class="summary-subtitle">Toplam Tutar</h4>
                                            </td>
                                            <td class=" pt-0 pb-0">
                                                <p class="summary-total-price ls-s text-primary">{{ cart.total_price }} ₺</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="payment accordion radio-type">
                                    <h4 class="summary-subtitle ls-m pb-3">Payment Methods</h4>
                                    <div class="card">
                                        <div class="card-header">
                                            <a href="#collapse1"
                                                class="collapse text-body text-normal ls-m">Kart ile öde
                                            </a>
                                        </div>
                                        <div id="collapse1" class="expanded" style="display: block;">
                                            <div class="card-body ls-m">
                                                <br>

                                                <label>Kart Üzerindeki İsim *</label>
                                                <input type="text" class="form-control" name="cartHolder" name="cartHolder" required="" placeholder="Ad Soyad" />
                                                <label>Kredi Kartı Numarası *</label>
                                                <input type="text" class="form-control" id="cardNumber" name="cardNumber" required="" placeholder="Kredi Kartı Numarası" maxlength="19" />
                                                <div class="row">
                                                    <div class="col-xs-6">
                                                        <label>SKT *</label>
                                                        <input type="text" class="form-control" id="cardExpiry" name="expiry" required="" placeholder="MM/YY" maxlength="5" />
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <label>CVV *</label>
                                                        <input type="number" class="form-control" id="cardCVV" name="cvv" placeholder="123" required="" maxlength="4" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-header">
                                            <a href="#collapse2" class="expand text-body text-normal ls-m">Havale/EFT ile öde</a>
                                        </div>
                                        <div id="collapse2" class="collapsed">
                                            <div class="card-body ls-m">
                                                Pay with cash upon delivery.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-checkbox mt-4 mb-5">
                                    <input type="checkbox" class="custom-checkbox" id="terms-condition"
                                        name="terms-condition" />
                                    <label class="form-control-label" for="terms-condition">
                                        <a href="javascript:void(0);" onclick="openPopup('Mesafeli Satış Sözleşmesi')">Mesafeli Satış Sözleşmesi</a>'ni okudum, onaylıyorum. *
                                    </label>
                                </div>
                                <div class="form-checkbox mt-4 mb-5">
                                    <input type="checkbox" class="custom-checkbox" id="terms-condition"
                                        name="terms-condition" />
                                    <label class="form-control-label" for="terms-condition">
                                        <a href="javascript:void(0);" onclick="openPopup('Ön Bilgilendirme Formu')">Ön Bilgilendirme Formu</a>'nu okudum, onaylıyorum. *
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-dark btn-rounded btn-order">
                                    Siparişi Oluştur
                                </button>
                            </div>
                        </div>
                    </aside>
                </div>
            </form>
        </div>
    </div>
    
</main>

{% endblock content %}

{% block extra_scripts %}
<script>
    function openPopup(pageTitle) {
        // Make AJAX request to Django view
        fetch(`/get-page-content/?page_title=${encodeURIComponent(pageTitle)}`)
            .then(response => response.json())
            .then(data => {
                if (data.content) {
                    // Assuming you have a function to show popup
                    showPopup(data.content); // Implement this function to display the content in a popup
                } else {
                    console.error('Error fetching page content');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function showPopup(content) {
        // Example: Simple popup - you might want to use a more sophisticated approach
        var popupWindow = window.open("", "Popup", "width=600,height=400,scrollbars=yes,resizable=yes");
        popupWindow.document.write(content);
    }
</script>

<script>
    document.getElementById('cardExpiry').addEventListener('input', function (e) {
        var input = e.target.value;
        var month = input.substring(0, 2);
        var year = input.substring(2, 4);

        if (input.length > 2 && input.indexOf('/') === -1) {
            e.target.value = month + '/' + year;
        } else if (input.length === 2 && e.data && !e.inputType.includes('delete')) {
            e.target.value = month + '/';
        }
    });
</script>
<script>
    document.getElementById('cardNumber').addEventListener('input', function (e) {
        var value = e.target.value.replace(/\s+/g, ''); // Remove existing spaces
        var formattedValue = '';
        for (var i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
                formattedValue += ' '; // Add a space every 4 digits
            }
            formattedValue += value[i];
        }
        e.target.value = formattedValue;
    });
</script>

{% endblock extra_scripts %}